<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Closing the Referral Loop with FHIR Subscriptions</title>
<meta name="description" content="A POC demonstrating referral loop closure using Josh Mandel's FHIR Subscriptions Broker architecture for the CMS Interoperability Framework.">
<meta name="author" content="Mohit Saigal">
<style>
@import url('https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,300;0,8..60,400;0,8..60,500;0,8..60,600;0,8..60,700;1,8..60,400;1,8..60,500&family=IBM+Plex+Mono:wght@400;500&family=Inter:wght@400;500;600&display=swap');

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --text: #1a1a1a;
  --text-secondary: #555;
  --text-muted: #888;
  --bg: #fafaf8;
  --surface: #fff;
  --border: #e5e5e0;
  --accent: #2563eb;
  --accent-muted: #dbeafe;
  --code-bg: #f5f5f0;
  --serif: 'Source Serif 4', Georgia, 'Times New Roman', serif;
  --sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  --mono: 'IBM Plex Mono', 'SF Mono', 'Consolas', monospace;
}

html { font-size: 17px; }

body {
  font-family: var(--serif);
  color: var(--text);
  background: var(--bg);
  line-height: 1.72;
  -webkit-font-smoothing: antialiased;
}

article {
  max-width: 700px;
  margin: 0 auto;
  padding: 3rem 1.5rem 6rem;
}

/* Header / Meta */
.article-meta {
  margin-bottom: 2.5rem;
  padding-bottom: 2rem;
  border-bottom: 1px solid var(--border);
}

h1 {
  font-family: var(--serif);
  font-size: 2rem;
  font-weight: 700;
  line-height: 1.2;
  letter-spacing: -0.02em;
  color: var(--text);
  margin-bottom: 1rem;
}

.byline {
  font-family: var(--sans);
  font-size: 0.82rem;
  color: var(--text-muted);
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex-wrap: wrap;
}

.byline a {
  color: var(--text-secondary);
  text-decoration: none;
  border-bottom: 1px solid var(--border);
  transition: border-color 0.2s;
}

.byline a:hover {
  border-color: var(--text-secondary);
}

.reading-time {
  display: flex;
  align-items: center;
  gap: 0.35rem;
}

.separator {
  color: var(--border);
}

/* Body */
p {
  margin-bottom: 1.25rem;
}

h2 {
  font-family: var(--serif);
  font-size: 1.35rem;
  font-weight: 600;
  line-height: 1.3;
  letter-spacing: -0.01em;
  margin-top: 2.5rem;
  margin-bottom: 1rem;
  color: var(--text);
}

strong {
  font-weight: 600;
}

/* Code blocks */
pre {
  background: var(--code-bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 1.25rem 1.5rem;
  overflow-x: auto;
  margin-bottom: 1.5rem;
  font-family: var(--mono);
  font-size: 0.72rem;
  line-height: 1.65;
  color: var(--text-secondary);
}

code {
  font-family: var(--mono);
  font-size: 0.85em;
  background: var(--code-bg);
  padding: 0.15em 0.35em;
  border-radius: 3px;
  color: var(--text);
}

pre code {
  background: none;
  padding: 0;
  font-size: inherit;
  color: inherit;
}

/* Links */
a {
  color: var(--accent);
  text-decoration: none;
  border-bottom: 1px solid transparent;
  transition: border-color 0.2s;
}

a:hover {
  border-bottom-color: var(--accent);
}

/* Footer */
.article-footer {
  margin-top: 3rem;
  padding-top: 2rem;
  border-top: 1px solid var(--border);
  font-family: var(--sans);
  font-size: 0.82rem;
  color: var(--text-muted);
  line-height: 1.6;
}

.article-footer a {
  color: var(--text-secondary);
  border-bottom: 1px solid var(--border);
}

.article-footer a:hover {
  border-bottom-color: var(--text-secondary);
}

.references {
  margin-top: 1.25rem;
}

.references li {
  margin-bottom: 0.5rem;
  list-style: none;
  padding-left: 0;
}

.references li::before {
  content: none;
}

/* Responsive */
@media (max-width: 600px) {
  html { font-size: 16px; }
  h1 { font-size: 1.65rem; }
  pre { font-size: 0.68rem; padding: 1rem; }
  article { padding: 2rem 1.25rem 4rem; }
}
</style>
</head>
<body>

<article>
  <header class="article-meta">
    <h1>Closing the Referral Loop with FHIR Subscriptions: A POC on Josh Mandel's Broker</h1>
    <div class="byline">
      <span>Mohit Saigal</span>
      <span class="separator">/</span>
      <span>February 2026</span>
      <span class="separator">/</span>
      <span class="reading-time">4 min read</span>
    </div>
  </header>

  <p>Dr. Smith is a primary care physician. His patient, Alice Rodriguez, has been experiencing chest pain on exertion, so he refers her to Dr. Sarah Johnson, a cardiologist at Mercy General Hospital. He sends the referral, tells Alice to schedule an appointment with Dr. Johnson's office, and that is the last he hears of it. Six weeks later, he has no idea whether Alice scheduled, showed up, or what Dr. Johnson found. The consult note might arrive by fax eventually, or it might not arrive at all.</p>

  <p>This is the referral loop closure problem: an out-of-band process where the referring physician creates a referral, the patient independently navigates scheduling with the specialist, and the referring physician waits for information to trickle back through fax or a phone call that may never come. The CMS Interoperability and Prior Authorization final rule (CMS-0057-F) addresses this directly, requiring CMS-Aligned Networks to support closed-loop referral tracking by July 2026 using FHIR Subscriptions for appointment and encounter notifications. The challenge, as <a href="https://github.com/jmandel/cms-fhir-subscriptions-broker">Josh Mandel articulated</a> in his Subscriptions Broker proposal, is that you cannot subscribe individually to every hospital in the country because you never know where a patient might turn up.</p>

  <h2>Josh's Broker model and what I built on top</h2>

  <p>Josh proposed a brokered architecture: instead of subscribing at each hospital individually, an application creates one FHIR Subscription at a Broker, and the Broker manages integrations with participating EHRs (converting ADT feeds, polling where push is unavailable) and delivers standardised FHIR notification bundles back to the subscriber. Patient identity works through IAL2-verified demographics rather than cross-organisation identifiers, with the Broker performing internal patient matching and returning a broker-scoped Patient.id.</p>

  <p>I built a <a href="https://github.com/durvester/referral-loop-closure">referral loop closure application</a> on top of Josh's Broker and simulated EHR (Mercy General). The application has two views: a patient portal for Alice and a physician dashboard for Dr. Smith. The POC assumes all parties (Alice's portal, Mercy General's EHR, the Broker) participate in the same CMS-Aligned Network or QHIN with established IAS trust relationships, and that the referral originates within Dr. Smith's system whilst Alice schedules her appointment independently.</p>

  <p>The end-to-end flow:</p>

<pre>
Dr. Smith                 Alice's Portal              Broker              Mercy General EHR
    |                          |                        |                        |
    |-- Create Referral ------>|                        |                        |
    |   (ServiceRequest +      |                        |                        |
    |    Task: "awaiting       |                        |                        |
    |    scheduling")          |                        |                        |
    |                          |                        |                        |
    |                          |-- IAL2 Verify -------->|                        |
    |                          |-- Register Patient --->|<-- Link sourceId ----->|
    |                          |-- Auth (Permission  -->|                        |
    |                          |   Ticket + JWT)        |                        |
    |                          |-- Create Subscription->|                        |
    |                          |-- Set Consent          |                        |
    |                          |   ("referrals only")   |                        |
    |                          |                        |                        |
    |                          |              Alice schedules appointment        |
    |                          |                        |                        |
    |                          |                        |<-- Encounter created --|
    |                          |                        |    (planned, Dr.       |
    |                          |                        |     Johnson, NPI match)|
    |                          |                        |                        |
    |                          |<-- Notification -------|                        |
    |                          |    (id-only bundle)    |                        |
    |                          |                        |                        |
    |                          |-- Fetch full Encounter ----------------------->|
    |                          |<-- Encounter resource (provider, NPI, reason) -|
    |                          |                        |                        |
    |                          |   [Matching engine: org NPI 35% + practitioner |
    |                          |    NPI 25% + name 20% + specialty 10% +        |
    |                          |    date window 10% = 1.0 score, auto-link]     |
    |                          |                        |                        |
    |                          |   [Task: "awaiting" -> "appointment scheduled"]|
    |                          |                        |                        |
    |<-- SSE: encounter -------|                        |                        |
    |   routed (consent OK)    |                        |                        |
    |                          |                        |                        |
    |   Loop continues for status updates:              |                        |
    |   planned -> in-progress -> finished -> "loop closed"                     |
</pre>

  <p>I made two modifications to Josh's EHR to support this. First, a <code>/trigger-event</code> endpoint to simulate encounter creation at Mercy General with specific practitioner and encounter details. Second, support for updating an existing encounter by ID (rather than creating a new one), enabling proper status progression on a single Encounter resource.</p>

  <h2>What works well in the Broker model</h2>

  <p><strong>The notification pipeline is clean and reliable.</strong> Creating a Subscription at the Broker, receiving <code>id-only</code> webhook notifications when Mercy General creates or updates an encounter, and fetching the full Encounter resource from the EHR's FHIR endpoint all function as expected. The abstraction is sound: the application connects once to the Broker and receives notifications from any participating data source without knowing anything about Mercy General's internal infrastructure.</p>

  <p><strong>Demographic-based patient matching handles cross-referencing well.</strong> The application never needs to know Mercy General's internal patient ID for Alice. The Broker maps IAL2-verified demographics to a broker-scoped Patient.id during onboarding, the EHR assigns its own local <code>sourceId</code> for Alice, and the application maintains the cross-reference through the broker session state. This lightweight MPI pattern works without requiring a universal patient identifier.</p>

  <p><strong>Real-time event delivery supports encounter lifecycle tracking.</strong> When Alice's encounter at Mercy General progresses from planned to in-progress to finished, the Broker delivers a notification for each status change on the same encounter. Both Alice's portal and Dr. Smith's dashboard update the existing entry in real time rather than creating duplicates, and the referral Task advances through its lifecycle (awaiting-scheduling to appointment-scheduled to encounter-in-progress to loop-closed). When Alice visits a psychiatrist (Dr. Chen) at Mercy General for an unrelated reason, that encounter arrives through the same pipeline but does not match Dr. Smith's referral. Because Alice chose "referral updates only," Dr. Smith never sees it.</p>

  <h2>Where the model needs work</h2>

  <p><strong>The access pattern is patient-dependent, which breaks for referral workflows.</strong> Currently everything flows through Alice: she onboards, her application creates the subscription, she grants consent. In a real referral workflow, Dr. Smith needs direct access to the Broker to subscribe on behalf of his practice. His EHR should be able to say "notify me when Alice Rodriguez has an encounter at any network facility" without requiring Alice to install an application and complete onboarding for every referral he creates. The Broker needs a provider-facing subscription path alongside the patient-facing one. Josh acknowledges the authorisation and consent propagation question as open, and for referral loop closure this is the critical gap. The Argonaut Project's proposed "SMART Permission Tickets" initiative could address this, but that work has not yet landed.</p>

  <p><strong>Patient matching needs to go beyond demographics.</strong> Name and date of birth are sufficient for a single-patient demo, but production deployment requires MPI integration with probabilistic matching, handling of name variations, and disambiguation when demographics collide.</p>

  <p><strong>Encounter-to-referral linking is inferential rather than deterministic.</strong> The matching engine scores encounters against open referrals using weighted NPI, organisation name, specialty, and date signals. This works (the cardiology encounter scores 1.0 against Dr. Smith's referral) but it is probabilistically inferred rather than provably correct. If Mercy General's EHR included the referral ID or a prior-authorisation number on the Encounter resource, matching would be trivial. Without standardised referral linkage on encounters, every subscriber has to build its own matching heuristic.</p>

  <h2>Closing thoughts</h2>

  <p>This POC validates that Josh's Subscriptions Broker model can support referral loop closure end-to-end: notification delivery from Mercy General through the Broker to Dr. Smith's dashboard, encounter lifecycle tracking, and consent-based routing all function as expected. The gaps are in access patterns (provider-initiated subscriptions) and production-grade identity and referral resolution, not in the fundamental architecture. The July 2026 CMS deadline is real, and this brokered approach is worth building on.</p>

  <footer class="article-footer">
    <p>The source code for this POC is available at <a href="https://github.com/durvester/referral-loop-closure">github.com/durvester/referral-loop-closure</a>.</p>

    <ul class="references">
      <li><a href="https://github.com/jmandel/cms-fhir-subscriptions-broker">Josh Mandel's FHIR Subscriptions Broker</a> &mdash; architecture proposal, specification, and demo</li>
      <li><a href="https://www.cms.gov/regulations-and-guidance/legislation/ehr-incentive-programs">CMS-0057-F</a> &mdash; Interoperability and Prior Authorization final rule</li>
    </ul>
  </footer>
</article>

</body>
</html>
